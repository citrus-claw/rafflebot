(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[285],{333:(e,t,a)=>{"use strict";a.d(t,{Ih:()=>i,cd:()=>f,PQ:()=>x,ps:()=>u,$m:()=>l,mm:()=>m,gg:()=>d,kP:()=>o});var n=a(6465);let r=JSON.parse('{"address":"HrfWNd6ayFHgf23XxLpHtBKY9TfjviiwBpXtdis8MDGU","metadata":{"name":"rafflebot","version":"0.1.0","spec":"0.1.0","description":"AI agent that creates and runs provably fair raffles on Solana"},"instructions":[{"name":"buy_tickets","docs":["Buy tickets for a raffle"],"discriminator":[48,16,122,137,24,214,198,58],"accounts":[{"name":"raffle","writable":true,"pda":{"seeds":[{"kind":"const","value":[114,97,102,102,108,101]},{"kind":"account","path":"raffle.authority","account":"Raffle"},{"kind":"account","path":"raffle.name","account":"Raffle"}]}},{"name":"entry","writable":true,"pda":{"seeds":[{"kind":"const","value":[101,110,116,114,121]},{"kind":"account","path":"raffle"},{"kind":"account","path":"buyer"}]}},{"name":"escrow","writable":true,"pda":{"seeds":[{"kind":"const","value":[101,115,99,114,111,119]},{"kind":"account","path":"raffle"}]}},{"name":"buyer_token_account","writable":true},{"name":"token_mint"},{"name":"buyer","writable":true,"signer":true},{"name":"token_program"},{"name":"system_program","address":"11111111111111111111111111111111"}],"args":[{"name":"num_tickets","type":"u32"}]},{"name":"cancel_raffle","docs":["Cancel raffle and enable refunds (authority only, or auto after deadline if threshold not met)"],"discriminator":[135,191,223,141,192,186,234,254],"accounts":[{"name":"raffle","writable":true,"pda":{"seeds":[{"kind":"const","value":[114,97,102,102,108,101]},{"kind":"account","path":"raffle.authority","account":"Raffle"},{"kind":"account","path":"raffle.name","account":"Raffle"}]}},{"name":"authority","docs":["Can be authority OR anyone (if deadline passed + threshold not met)"],"signer":true}],"args":[]},{"name":"claim_prize","docs":["Claim prize (winner calls this with their entry)"],"discriminator":[157,233,139,121,246,62,234,235],"accounts":[{"name":"raffle","writable":true,"pda":{"seeds":[{"kind":"const","value":[114,97,102,102,108,101]},{"kind":"account","path":"raffle.authority","account":"Raffle"},{"kind":"account","path":"raffle.name","account":"Raffle"}]}},{"name":"winner_entry","pda":{"seeds":[{"kind":"const","value":[101,110,116,114,121]},{"kind":"account","path":"raffle"},{"kind":"account","path":"winner"}]}},{"name":"escrow","writable":true,"pda":{"seeds":[{"kind":"const","value":[101,115,99,114,111,119]},{"kind":"account","path":"raffle"}]}},{"name":"winner_token_account","writable":true},{"name":"platform_token_account","writable":true},{"name":"token_mint"},{"name":"winner"},{"name":"token_program"}],"args":[]},{"name":"claim_refund","docs":["Claim refund (for cancelled raffles)"],"discriminator":[15,16,30,161,255,228,97,60],"accounts":[{"name":"raffle","pda":{"seeds":[{"kind":"const","value":[114,97,102,102,108,101]},{"kind":"account","path":"raffle.authority","account":"Raffle"},{"kind":"account","path":"raffle.name","account":"Raffle"}]}},{"name":"entry","writable":true,"pda":{"seeds":[{"kind":"const","value":[101,110,116,114,121]},{"kind":"account","path":"raffle"},{"kind":"account","path":"buyer"}]}},{"name":"escrow","writable":true,"pda":{"seeds":[{"kind":"const","value":[101,115,99,114,111,119]},{"kind":"account","path":"raffle"}]}},{"name":"buyer_token_account","writable":true},{"name":"token_mint"},{"name":"buyer"},{"name":"token_program"}],"args":[]},{"name":"commit_draw","docs":["Phase 1: Commit to Switchboard randomness (authority calls after deadline)","Bundle this instruction with Switchboard\'s commitIx in the same tx"],"discriminator":[210,106,32,68,253,95,229,1],"accounts":[{"name":"raffle","writable":true,"pda":{"seeds":[{"kind":"const","value":[114,97,102,102,108,101]},{"kind":"account","path":"raffle.authority","account":"Raffle"},{"kind":"account","path":"raffle.name","account":"Raffle"}]}},{"name":"authority","signer":true,"relations":["raffle"]},{"name":"randomness_account"}],"args":[]},{"name":"create_raffle","docs":["Create a new raffle (agent-only in practice, but permissionless on-chain)"],"discriminator":[226,206,159,34,213,207,98,126],"accounts":[{"name":"raffle","writable":true,"pda":{"seeds":[{"kind":"const","value":[114,97,102,102,108,101]},{"kind":"account","path":"authority"},{"kind":"arg","path":"name"}]}},{"name":"escrow","writable":true,"pda":{"seeds":[{"kind":"const","value":[101,115,99,114,111,119]},{"kind":"account","path":"raffle"}]}},{"name":"token_mint","docs":["The SPL token mint (e.g., USDC)"]},{"name":"platform_wallet","docs":["Platform wallet to receive fees"]},{"name":"authority","writable":true,"signer":true},{"name":"token_program"},{"name":"system_program","address":"11111111111111111111111111111111"}],"args":[{"name":"name","type":"string"},{"name":"ticket_price","type":"u64"},{"name":"min_pot","type":"u64"},{"name":"max_per_wallet","type":"u32"},{"name":"end_time","type":"i64"}]},{"name":"settle_draw","docs":["Phase 2: Settle draw using revealed Switchboard randomness","Bundle this instruction with Switchboard\'s revealIx in the same tx"],"discriminator":[175,154,75,30,118,117,107,194],"accounts":[{"name":"raffle","writable":true,"pda":{"seeds":[{"kind":"const","value":[114,97,102,102,108,101]},{"kind":"account","path":"raffle.authority","account":"Raffle"},{"kind":"account","path":"raffle.name","account":"Raffle"}]}},{"name":"authority","signer":true,"relations":["raffle"]},{"name":"randomness_account"}],"args":[]}],"accounts":[{"name":"Entry","discriminator":[63,18,152,113,215,246,221,250]},{"name":"Raffle","discriminator":[143,133,63,173,138,10,142,200]}],"errors":[{"code":6000,"name":"InvalidEndTime","msg":"End time must be in the future"},{"code":6001,"name":"InvalidTicketPrice","msg":"Ticket price must be greater than 0"},{"code":6002,"name":"InvalidMinPot","msg":"Minimum pot must be greater than 0"},{"code":6003,"name":"MinPotTooLow","msg":"Minimum pot must be >= ticket price"},{"code":6004,"name":"InvalidName","msg":"Name must be 1-32 characters"},{"code":6005,"name":"RaffleNotActive","msg":"Raffle is not active"},{"code":6006,"name":"RaffleClosed","msg":"Raffle has ended"},{"code":6007,"name":"InvalidTicketCount","msg":"Invalid ticket count"},{"code":6008,"name":"MaxTicketsExceeded","msg":"Maximum tickets per wallet exceeded"},{"code":6009,"name":"Overflow","msg":"Arithmetic overflow"},{"code":6010,"name":"RaffleNotEnded","msg":"Raffle has not ended yet"},{"code":6011,"name":"NoTickets","msg":"No tickets sold"},{"code":6012,"name":"ThresholdNotMet","msg":"Minimum pot threshold not met"},{"code":6013,"name":"DrawNotComplete","msg":"Draw not complete"},{"code":6014,"name":"NoWinnerDrawn","msg":"No winner drawn"},{"code":6015,"name":"NotWinner","msg":"Not the winner"},{"code":6016,"name":"CannotCancel","msg":"Cannot cancel raffle"},{"code":6017,"name":"RaffleNotCancelled","msg":"Raffle is not cancelled"},{"code":6018,"name":"NotEntryOwner","msg":"Not the entry owner"},{"code":6019,"name":"AlreadyRefunded","msg":"Already refunded"},{"code":6020,"name":"InvalidRandomnessAccount","msg":"Invalid randomness account"},{"code":6021,"name":"InvalidRandomnessAccountOwner","msg":"Invalid randomness account owner"},{"code":6022,"name":"RandomnessExpired","msg":"Randomness has expired"},{"code":6023,"name":"RandomnessAlreadyRevealed","msg":"Randomness already revealed"},{"code":6024,"name":"RandomnessNotResolved","msg":"Randomness not yet resolved"},{"code":6025,"name":"DrawNotCommitted","msg":"Draw not committed yet"}],"types":[{"name":"Entry","type":{"kind":"struct","fields":[{"name":"raffle","type":"pubkey"},{"name":"buyer","type":"pubkey"},{"name":"start_ticket_index","type":"u32"},{"name":"num_tickets","type":"u32"},{"name":"is_initialized","type":"bool"},{"name":"refunded","type":"bool"},{"name":"bump","type":"u8"}]}},{"name":"Raffle","type":{"kind":"struct","fields":[{"name":"authority","type":"pubkey"},{"name":"name","type":"string"},{"name":"token_mint","type":"pubkey"},{"name":"escrow","type":"pubkey"},{"name":"platform_wallet","type":"pubkey"},{"name":"ticket_price","type":"u64"},{"name":"min_pot","type":"u64"},{"name":"max_per_wallet","type":"u32"},{"name":"end_time","type":"i64"},{"name":"total_tickets","type":"u32"},{"name":"total_pot","type":"u64"},{"name":"status","type":{"defined":{"name":"RaffleStatus"}}},{"name":"winner","type":{"option":"pubkey"}},{"name":"winning_ticket","type":{"option":"u32"}},{"name":"randomness","type":{"option":{"array":["u8",32]}}},{"name":"randomness_account","type":{"option":"pubkey"}},{"name":"commit_slot","type":{"option":"u64"}},{"name":"created_at","type":"i64"},{"name":"bump","type":"u8"},{"name":"escrow_bump","type":"u8"}]}},{"name":"RaffleStatus","type":{"kind":"enum","variants":[{"name":"Active"},{"name":"DrawCommitted"},{"name":"DrawComplete"},{"name":"Claimed"},{"name":"Cancelled"}]}}]}');var s=a(2463).Buffer;let i=r,c=new n.PublicKey("HrfWNd6ayFHgf23XxLpHtBKY9TfjviiwBpXtdis8MDGU");function l(e){return!!e.active}function o(e){return!!e.drawComplete}function d(e){return!!e.claimed}function m(e){return!!e.cancelled}function u(e){return e.active?"Active":e.drawCommitted?"Drawing...":e.drawComplete?"Winner Drawn":e.claimed?"Claimed":e.cancelled?"Cancelled":"Unknown"}function f(e,t){return n.PublicKey.findProgramAddressSync([s.from("entry"),e.toBuffer(),t.toBuffer()],c)}function x(e){return n.PublicKey.findProgramAddressSync([s.from("escrow"),e.toBuffer()],c)}},850:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>h});var n=a(2115),r=a(7091),s=a(875),i=a(9738),c=a(6465),l=a(1084),o=a(7235),d=a.n(o),m=a(333),u=a(9389),f=a(2021),x=a(6459);function p(e){let{entry:t,isWinner:a}=e,r=(0,m.$m)(t.raffle.status),s=t.raffle.totalTickets>0?t.entry.numTickets/t.raffle.totalTickets*100:0;return(0,n.jsxs)(d(),{href:"/raffle/".concat(t.rafflePubkey.toBase58()),className:(0,f.cn)("group relative block overflow-hidden rounded-2xl bg-white shadow-md transition-all hover:-translate-y-0.5 hover:shadow-lg",!r&&!a&&"opacity-55"),children:[a&&(0,n.jsxs)("div",{className:"flex items-center gap-2 bg-gradient-to-r from-gold to-amber-400 px-5 py-2",children:[(0,n.jsx)("span",{className:"text-sm",children:"\uD83C\uDFC6"}),(0,n.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-wider text-ink",children:"You won this raffle!"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3.5 px-5 py-4",children:[(0,n.jsxs)("div",{className:(0,f.cn)("flex h-12 w-12 shrink-0 flex-col items-center justify-center rounded-xl",r&&"bg-carnival-red text-white",!r&&!a&&"bg-ink/5 text-muted",a&&"bg-gold text-ink"),children:[(0,n.jsx)("span",{className:"font-display text-xl leading-none",children:t.entry.numTickets}),(0,n.jsx)("span",{className:"text-[7px] uppercase tracking-wider opacity-80",children:"tix"})]}),(0,n.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,n.jsx)("div",{className:"truncate text-sm font-semibold text-ink",children:t.raffle.name}),(0,n.jsxs)("div",{className:"text-[10px] text-muted",children:["No.",t.entry.startTicketIndex,"–",t.entry.startTicketIndex+t.entry.numTickets-1]})]}),(0,n.jsx)("div",{className:"shrink-0 text-right",children:(0,n.jsx)("span",{className:(0,f.cn)("inline-block rounded-full px-2.5 py-0.5 text-[9px] font-bold uppercase",r&&"bg-carnival-red/10 text-carnival-red",a&&"bg-gold/15 text-amber-700",!r&&!a&&"bg-ink/5 text-muted"),children:r?"".concat((0,x.$B)(t.raffle.endTime)," left"):a?"Winner!":(0,m.ps)(t.raffle.status)})})]}),(0,n.jsxs)("div",{className:"flex border-t border-ink/5",children:[(0,n.jsxs)("div",{className:"flex-1 border-r border-ink/5 px-4 py-2.5 text-center",children:[(0,n.jsx)("div",{className:"text-xs font-bold text-carnival-red",children:(0,x.Vx)(t.raffle.totalPot)}),(0,n.jsx)("div",{className:"mt-0.5 text-[8px] font-bold uppercase tracking-wider text-muted",children:a?"Total Pot":"Pot"})]}),(0,n.jsxs)("div",{className:"flex-1 border-r border-ink/5 px-4 py-2.5 text-center",children:[(0,n.jsx)("div",{className:"text-xs font-bold text-ink",children:(0,x.Vx)(t.raffle.ticketPrice)}),(0,n.jsx)("div",{className:"mt-0.5 text-[8px] font-bold uppercase tracking-wider text-muted",children:"Per Ticket"})]}),(0,n.jsxs)("div",{className:"flex-1 border-r border-ink/5 px-4 py-2.5 text-center",children:[(0,n.jsx)("div",{className:"text-xs font-bold text-ink",children:t.raffle.totalTickets.toLocaleString()}),(0,n.jsx)("div",{className:"mt-0.5 text-[8px] font-bold uppercase tracking-wider text-muted",children:"Total Sold"})]}),(0,n.jsx)("div",{className:"flex-1 px-4 py-2.5 text-center",children:r||a||!t.raffle.winner?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:(0,f.cn)("text-xs font-bold",a?"text-gold":"text-carnival-blue"),children:[s.toFixed(1),"%"]}),(0,n.jsx)("div",{className:"mt-0.5 text-[8px] font-bold uppercase tracking-wider text-muted",children:"Your Odds"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"font-mono text-xs font-bold text-muted",children:(0,x.Wr)(t.raffle.winner.toBase58())}),(0,n.jsx)("div",{className:"mt-0.5 text-[8px] font-bold uppercase tracking-wider text-muted",children:"Winner"})]})})]})]})}function h(){let{publicKey:e,connected:t}=(0,s.v)(),{connection:a}=(0,i.w)(),[o,x]=(0,r.useState)([]),[h,y]=(0,r.useState)(!0);if((0,r.useEffect)(()=>{!async function(){if(!e){x([]),y(!1);return}try{y(!0);let t={publicKey:c.PublicKey.default,signTransaction:async()=>{throw Error("Read-only")},signAllTransactions:async()=>{throw Error("Read-only")}},n=new l.NQ(a,t,{commitment:"confirmed"}),r=new l.BP(m.Ih,n),s=await r.account.entry.all([{memcmp:{offset:40,bytes:e.toBase58()}}]),i=[];for(let e of s)try{let t=await r.account.raffle.fetch(e.account.raffle);i.push({entryPubkey:e.publicKey,entry:e.account,raffle:t,rafflePubkey:e.account.raffle})}catch(e){}i.sort((e,t)=>{let a=(0,m.$m)(e.raffle.status),n=(0,m.$m)(t.raffle.status);return a&&!n?-1:!a&&n?1:t.raffle.endTime.toNumber()-e.raffle.endTime.toNumber()}),x(i)}catch(e){console.error("Failed to fetch entries:",e)}finally{y(!1)}}()},[e,a]),!t)return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"bg-carnival-red py-12 text-center text-white",children:[(0,n.jsx)("h1",{className:"font-display text-4xl",children:"My Stubs"}),(0,n.jsx)("p",{className:"mx-auto mt-2 max-w-md text-xs opacity-80",children:"Your raffle ticket collection"})]}),(0,n.jsxs)("div",{className:"mx-auto max-w-3xl px-6 py-20 text-center",children:[(0,n.jsx)("span",{className:"mb-4 block text-6xl",children:"\uD83C\uDF9F️"}),(0,n.jsx)("p",{className:"font-display text-lg text-ink/60",children:"Connect Your Wallet"}),(0,n.jsx)("p",{className:"mt-1 text-[10px] text-ink/40",children:"Connect your wallet to see your ticket stubs"})]})]});if(h)return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"bg-carnival-red py-12 text-center text-white",children:[(0,n.jsx)("h1",{className:"font-display text-4xl",children:"My Stubs"}),(0,n.jsx)("p",{className:"mx-auto mt-2 max-w-md text-xs opacity-80",children:"Your raffle ticket collection"})]}),(0,n.jsxs)("div",{className:"mx-auto max-w-3xl px-6 py-20 text-center",children:[(0,n.jsx)(u.A,{size:48,className:"mx-auto mb-4 animate-bounce text-carnival-red"}),(0,n.jsx)("p",{className:"font-display text-xs uppercase tracking-widest text-ink/60",children:"Fetching your stubs..."})]})]});let k=o.filter(e=>(0,m.$m)(e.raffle.status)),b=o.filter(e=>!(0,m.$m)(e.raffle.status)),g=o.reduce((e,t)=>e+t.entry.numTickets,0),w=o.reduce((e,t)=>e+t.entry.numTickets*t.raffle.ticketPrice.toNumber(),0)/1e6,v=o.filter(t=>t.raffle.winner&&t.raffle.winner.equals(e)).length;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"bg-carnival-red py-12 text-center text-white",children:[(0,n.jsx)("h1",{className:"font-display text-4xl",children:"My Stubs"}),(0,n.jsx)("p",{className:"mx-auto mt-2 max-w-md text-xs opacity-80",children:"Your raffle ticket collection"})]}),(0,n.jsxs)("div",{className:"mx-auto max-w-3xl px-6",children:[(0,n.jsx)("div",{className:"-mt-6 mb-8 flex flex-wrap justify-center gap-3",children:[{label:"Total Tickets",value:g.toString(),color:"text-carnival-blue"},{label:"Total Spent",value:"$".concat(w.toFixed(2)),color:"text-carnival-red"},{label:"Wins",value:v.toString(),color:"text-gold"}].map(e=>(0,n.jsxs)("div",{className:"min-w-[140px] rounded-2xl bg-white/90 px-6 py-4 text-center shadow-lg backdrop-blur-sm",children:[(0,n.jsx)("div",{className:(0,f.cn)("text-xl font-black",e.color),children:e.value}),(0,n.jsx)("div",{className:"mt-0.5 text-[9px] font-bold uppercase tracking-wider text-muted",children:e.label})]},e.label))}),0===o.length?(0,n.jsxs)("div",{className:"rounded-2xl bg-surface py-16 text-center",children:[(0,n.jsx)("span",{className:"mb-4 block text-6xl",children:"\uD83C\uDFAA"}),(0,n.jsx)("p",{className:"font-display text-lg text-ink/60",children:"No tickets yet"}),(0,n.jsx)("p",{className:"mt-1 text-[10px] text-ink/40",children:"You haven't entered any raffles"}),(0,n.jsx)(d(),{href:"/",className:"mt-4 inline-block font-display text-xs uppercase tracking-widest text-carnival-red",children:"Visit the Midway →"})]}):(0,n.jsxs)(n.Fragment,{children:[k.length>0&&(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsxs)("div",{className:"mb-3 flex items-center gap-2",children:[(0,n.jsx)("h2",{className:"font-display text-sm uppercase text-ink",children:"Active Entries"}),(0,n.jsx)("span",{className:"h-2 w-2 animate-pulse rounded-full bg-carnival-red"})]}),(0,n.jsx)("div",{className:"flex flex-col gap-3",children:k.map(e=>(0,n.jsx)(p,{entry:e,isWinner:!1},e.entryPubkey.toBase58()))})]}),b.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"mb-3 font-display text-sm uppercase text-ink/40",children:"Past Entries"}),(0,n.jsx)("div",{className:"flex flex-col gap-3",children:b.map(t=>{let a=!!(t.raffle.winner&&t.raffle.winner.equals(e));return(0,n.jsx)(p,{entry:t,isWinner:a},t.entryPubkey.toBase58())})})]})]}),(0,n.jsx)("div",{className:"h-12"})]})]})}},2021:(e,t,a)=>{"use strict";a.d(t,{cn:()=>s});var n=a(5695),r=a(421);function s(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,n.$)(t))}},3514:()=>{},4413:(e,t,a)=>{Promise.resolve().then(a.bind(a,850))},6459:(e,t,a)=>{"use strict";function n(e){return(e.toNumber()/1e6).toLocaleString("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2})}function r(e){let t=Math.floor(Date.now()/1e3),a=e.toNumber()-t;if(a<=0)return"Ended";let n=Math.floor(a/86400),r=Math.floor(a%86400/3600),s=Math.floor(a%3600/60);return n>0?"".concat(n,"d ").concat(r,"h"):r>0?"".concat(r,"h ").concat(s,"m"):"".concat(s,"m")}function s(e){return new Date(1e3*e.toNumber()).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function i(e){return new Date(1e3*e.toNumber()).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}function c(e){return"".concat(e.slice(0,4),"…").concat(e.slice(-4))}a.d(t,{$B:()=>r,Vx:()=>n,Wr:()=>c,Yq:()=>s,r6:()=>i})}},e=>{e.O(0,[692,891,346,696,797,483,235,523,657,358],()=>e(e.s=4413)),_N_E=e.O()}]);